<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Government Help Center Locator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../global.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html,
    body {
      width: 100%;
      height: 100%;
      background-color: burlywood;
    }

    main {
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      flex-direction: column;
      gap: 20px;
    }

    #map {
      width: 300px;
      height: 300px;
      margin-left: 4px;
      border-radius: 10px;
    }

    .controls {
      background: white;
      padding: 12px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
      gap: 8px;
      width: 220px;
      margin: 40px 38px;
    }

    button,
    select {
      padding: 10px;
      font-size: 14px;
      cursor: pointer;
      border-radius: 6px;
      border: none;
    }

    button {
      background: #2563eb;
      color: white;
    }

    select {
      border: 1px solid #ccc;
    }

    @media (min-width: 768px) {
      .ham-btn {
        display: none;
      }

      .nav-menu {
        position: static;
        height: auto;
        width: auto;
        flex-direction: row;
        align-items: center;
        background: transparent;
        padding: 0;
        box-shadow: none;
      }

      .logo-container img {
        height: 70px;
        width: auto;
      }

      #map {
        width: 700px;
        height: 700px;
        margin-left: 40px;
        border-radius: 10px;
      }
    }

    @media (min-width: 1024px) {
      #map {
        width: 1000px;
        height: 1000px;
        margin: auto;
        border-radius: 10px;
      }
    }
  </style>
</head>

<body>
  <!-- GLOBAL LOADER -->
  <div id="ss-loader">
    <div class="ss-loader-box">
      <div class="ss-spinner"></div>
      <p class="ss-loading-text">Loading Seva Sathi‚Ä¶</p>
    </div>
  </div>
  <nav>
    <div class="nav-overlay" id="navOverlay"></div>

    <div class="logo-container">
      <img src="../images/logostrok.png" alt="Logo">
    </div>

    <div class="ham-btn" id="menuToggle" aria-label="Toggle menu" role="button">
      <span></span>
      <span></span>
      <span></span>
    </div>

    <div class="nav-menu" id="sideNav">
      <a href="../home-page/index.html" data-key="nav.home">Home</a>
      <a href="../home-page/index.html" data-key="nav.about">About</a>
      <a href="../schemes/index.html" data-key="nav.schemes">Schemes</a>
      <a href="../doc-updates/index.html" data-key="nav.updates">Updates</a>
      <button class="lang-btn" > <span data-key="nav.language">Language</span> <span>‚ñæ</span></button>
    </div>
  </nav>
  <main>

    <div class="controls">
      <button onclick="useMyLocation()" data-key="controls.button">üìç Use My Location</button>

      <select onchange="searchByCity(this.value)">
        <option value="" data-key="controls.select.value1">Search by City</option>
        <option value="Bengaluru" data-key="controls.select.value2">Bengaluru</option>
        <option value="Mysuru" data-key="controls.select.value3">Mysuru</option>
        <option value="Mangaluru" data-key="controls.select.value4">Mangaluru</option>
        <option value="Hubballi" data-key="controls.select.value5">Hubballi</option>
        <option value="Belagavi" data-key="controls.select.value6">Belagavi</option>
        <option value="Shivamogga" data-key="controls.select.value7">Shivamogga</option>
      </select>
    </div>

    <div id="map"></div>
  </main>
  <footer>
    <div class="footer-content">
      <div class="footer-links-container">
        <!-- Column 1 -->
        <div class="footer-column">
          <ul>
            <a href="../home-page/index.html" data-key="footer.Column1.home">Home</a>
            <a href="../home-page/index.html" data-key="footer.Column1.about">About</a>
            <a href="../schemes/index.html" data-key="footer.Column1.schemes">Schemes</a>
            <a href="../doc-updates/index.html" data-key="footer.Column1.updates">Updates</a>
          </ul>
        </div>

        <!-- Column 2 -->
        <div class="footer-column">
          <ul>
            <li><a href="../schemes/index.html" data-key="footer.Column2.links.a1">Government Schemes</a></li>
            <li><a href="../form-page/index.html" data-key="footer.Column2.links.a2">Form Guidance</a></li>
            <li><a href="../notice explainer/index.html" data-key="footer.Column2.links.a3">Notice Explainer</a></li>
            <li><a href="../scam-page/index.html" data-key="footer.Column2.links.a4">Scam Alert</a></li>
            <li><a href="../doc-updates/index.html" data-key="footer.Column2.links.a5">Doc Updates</a></li>
            <li><a href="../location feature/helpcenter.html" data-key="footer.Column2.links.a6">Help Center Locator</a>
            </li>
          </ul>
        </div>
      </div>

      <!-- Footer Bottom -->
      <div class="footer-bottom">
        <!-- <p class="footer-disclaimer">
                    We only provide guidance. All submissions happen on official government portals.
                </p> -->
        <p class="footer-copyright" data-key="footer.copyright">
          ¬© 2026 SevaSaathi. All rights reserved.
        </p>
      </div>
    </div>

    <!-- Diagonal Green Triangle -->
    <div class="footer-triangle"></div>

    <!-- Logo in Triangle -->
    <div class="footer-logo">
      <img src="../images/logo.png" alt="SevaSaathi Logo" class="footer-logo-img">
    </div>
  </footer>

  <script>
    let map;
    let service;
    let markers = [];

    const cityLocations = {
      Bengaluru: { lat: 12.9716, lng: 77.5946 },
      Mysuru: { lat: 12.2958, lng: 76.6394 },
      Mangaluru: { lat: 12.9141, lng: 74.8560 },
      Hubballi: { lat: 15.3647, lng: 75.1240 },
      Belagavi: { lat: 15.8497, lng: 74.4977 },
      Shivamogga: { lat: 13.9299, lng: 75.5681 }
    };

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 15.3173, lng: 75.7139 }, // Karnataka
        zoom: 7
      });
    }

    // -------- USE MY LOCATION --------
    function useMyLocation() {
      if (!navigator.geolocation) {
        alert("Geolocation not supported");
        return;
      }

      navigator.geolocation.getCurrentPosition(
        (position) => {
          const userLocation = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };

          map.setCenter(userLocation);
          map.setZoom(14);

          clearMarkers();

          // User marker
          new google.maps.Marker({
            map,
            position: userLocation,
            label: "You"
          });

          findHelpCenters(userLocation);
        },
        () => {
          alert("Location permission denied");
        }
      );
    }

    // -------- SEARCH BY CITY --------
    function searchByCity(city) {
      if (!city) return;

      const location = cityLocations[city];

      map.setCenter(location);
      map.setZoom(13);

      clearMarkers();
      findHelpCenters(location);
    }

    // -------- COMMON SEARCH LOGIC --------
    function findHelpCenters(location) {
      service = new google.maps.places.PlacesService(map);

      const request = {
        location: location,
        radius: 8000,
        keyword: "government office"
      };

      service.nearbySearch(request, (results, status) => {
        console.log("Places status:", status);

        if (status === google.maps.places.PlacesServiceStatus.OK) {
          results.forEach(addMarker);
        } else {
          alert("No government help centers found: " + status);
        }
      });
    }

    function addMarker(place) {
      const marker = new google.maps.Marker({
        map,
        position: place.geometry.location,
        title: place.name
      });

      const infoWindow = new google.maps.InfoWindow({
        content: `
        <strong>${place.name}</strong><br>
        ${place.vicinity || ""}<br>
        <a target="_blank"
           href="https://www.google.com/maps/place/?q=place_id:${place.place_id}">
           Open in Google Maps
        </a>
      `
      });

      marker.addListener("click", () => {
        infoWindow.open(map, marker);
      });

      markers.push(marker);
    }

    function clearMarkers() {
      markers.forEach(m => m.setMap(null));
      markers = [];
    }
  </script>

  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDgu9ThTU02IqywYz489aYzN_j2utn1q1o&libraries=places&callback=initMap"
    async defer>
    </script>
  <script src="../cors/loader.js"></script>
  <script src="../cors/language-guard.js"></script>
  <script src="../cors/content-loader.js"></script>
  <script src="../home-page/script.js"></script>


</body>

</html>